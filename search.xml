<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ubuntu安装cuda驱动</title>
      <link href="/2025/04/05/Linux/5/"/>
      <url>/2025/04/05/Linux/5/</url>
      
        <content type="html"><![CDATA[<h1 id="一安装nvidia-driver">一、安装nvidia-driver</h1><p>运行 <code>ubuntu-drivers devices</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(base) diraw@solitude:~$ ubuntu-drivers devices</span><br><span class="line">== /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0 ==</span><br><span class="line">modalias : pci:v000010DEd00002520sv00001043sd00001CBCbc03sc00i00</span><br><span class="line">vendor   : NVIDIA Corporation</span><br><span class="line">model    : GA106M [GeForce RTX 3060 Mobile / Max-Q]</span><br><span class="line">driver   : nvidia-driver-570-server-open - distro non-free</span><br><span class="line">driver   : nvidia-driver-550-open - distro non-free</span><br><span class="line">driver   : nvidia-driver-545 - distro non-free</span><br><span class="line">driver   : nvidia-driver-470-server - distro non-free</span><br><span class="line">driver   : nvidia-driver-570-server - distro non-free</span><br><span class="line">driver   : nvidia-driver-535-open - distro non-free</span><br><span class="line">driver   : nvidia-driver-470 - distro non-free</span><br><span class="line">driver   : nvidia-driver-535 - distro non-free</span><br><span class="line">driver   : nvidia-driver-550 - distro non-free recommended</span><br><span class="line">driver   : nvidia-driver-545-open - distro non-free</span><br><span class="line">driver   : nvidia-driver-535-server - distro non-free</span><br><span class="line">driver   : nvidia-driver-535-server-open - distro non-free</span><br><span class="line">driver   : xserver-xorg-video-nouveau - distro free <span class="built_in">builtin</span></span><br></pre></td></tr></table></figure><p>其中550版本被标记为<code>recommended</code></p><p>运行<code>sudo apt install nvidia-driver-550</code></p><p>之后会让你输入密码，完成之后<code>sudo reboot</code>，出现下图：</p><p><img src="/img/202504/6.png" alt="Image 6"></p><p>选择第二行<code>Enroll MOK</code>，然后出现下图：</p><p><img src="/img/202504/7.png" alt="Image 7"></p><p>选择<code>continue</code></p><p><img src="/img/202504/8.png" alt="Image 8"></p><p>然后选择<code>reboot</code></p><p>重启之后，运行<code>nvidia-smi</code>，预期出现下图，右上角为所支持的最大版本cuda，我这个为12.04</p><p><img src="/img/202504/9.png" alt="Image 9"></p><h1 id="二安装cuda-toolkit">二、安装CUDA Toolkit</h1><blockquote><p>不能（？存疑）通过<code>sudo apt install nvidia-cuda-toolkit</code>安装，会出现版本不一致的情况，使用<code>sudo apt purge nvidia-cuda-toolkit</code>，然后使用<code>sudo apt autoremove</code>，卸载apt 安装的 CUDA</p></blockquote><p>去https://developer.nvidia.com/cuda-toolkit-archive，选择12.04</p><p><img src="/img/202504/10.png" alt="Image 10"></p><p>然后选择你的配置</p><p><img src="/img/202504/11.png" alt="Image 11"></p><p>然后把下面的代码走一遍</p><p><img src="/img/202504/12.png" alt="Image 12"></p><p>传统内核模块:可能与旧系统或需要传统驱动结构的特定软件具有更好的兼容性。</p><p>开放内核模块:使用开源内核模块，可以更好地与 Linux内核集成，潜在地提高安全性并加快更新速度。</p><p>这里选择第二个，以及如果第一步操作了，nvidia-driver已经安装了，执行第二条即可</p><p><img src="/img/202504/13.png" alt="Image 13"></p><p>检查成功：<code>nvcc --version</code></p><h1 id="三添加环境变量">三、添加环境变量</h1><p><code>nano ~/.bashrc</code></p><p>添加以下行到文件末尾</p><p><code>export CUDA_HOME=/usr/local/cuda export PATH=$CUDA_HOME/bin:$PATH export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH</code></p><p>应用更改<code>source ~/.bashrc</code></p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
            <tag> cuda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重装ubuntu初始化</title>
      <link href="/2025/04/05/Linux/4/"/>
      <url>/2025/04/05/Linux/4/</url>
      
        <content type="html"><![CDATA[<p><strong>1、安装clash</strong> <a href="https://app.chongjin01.icu/Linux/" class="uri">https://app.chongjin01.icu/Linux/</a></p><p>dpkg出现依赖错误，使用<code>sudo apt install -f</code></p><p><strong>2、安装QQ</strong> <a href="https://im.qq.com/linuxqq/index.shtml" class="uri">https://im.qq.com/linuxqq/index.shtml</a></p><p><strong>3、安装vscode</strong> <a href="https://diraw.top/2025/04/04/Linux/2/" class="uri">https://diraw.top/2025/04/04/Linux/2/</a></p><p><strong>4、安装flameshot</strong> <a href="https://github.com/flameshot-org/flameshot" class="uri">https://github.com/flameshot-org/flameshot</a></p><p>设置-键盘-快捷键，命令为<code>flameshot gui</code></p><p><strong>5、安装输入法</strong></p><p>SunPinYin：<code>sudo apt-get install ibus-sunpinyin</code></p><p><strong>6、安装anaconda</strong> <a href="https://www.anaconda.com/download/success" class="uri">https://www.anaconda.com/download/success</a></p><p>记得最后把conda添加到环境变量，如果忘了话执行：<code>eval "$(/home/diraw/anaconda3/bin/conda shell.bash hook)"</code></p><p>镜像源：</p><p>pip：<code>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></p><p>conda：注：由于更新过快难以同步，我们不同步pytorch-nightly，pytorch-nightly-cpu，ignite-nightly这三个包。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/linux-64/</span><br><span class="line">conda config --set show_channel_urls yes</span><br></pre></td></tr></table></figure><p><strong>7、安装cuda驱动</strong> <a href="https://diraw.top/2025/04/05/Linux/5/" class="uri">https://diraw.top/2025/04/05/Linux/5/</a></p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何缩短Linux终端中显示的用户名前缀</title>
      <link href="/2025/04/04/Linux/3/"/>
      <url>/2025/04/04/Linux/3/</url>
      
        <content type="html"><![CDATA[<h1 id="问题描述">问题描述</h1><p><img src="/img/202504/2.png" alt="Image 2"></p><p>新装的ubuntu，这个终端的名称也太长了，主要是@后面这个设备名，所以我想把这玩意儿改短一些</p><h1 id="解决办法">解决办法</h1><p>打开<code>~/.bashrc</code>文件，找到如下内容：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$color_prompt</span>"</span> = <span class="built_in">yes</span> ]; <span class="keyword">then</span></span><br><span class="line">    PS1=<span class="string">'${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    PS1=<span class="string">'${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul><li><code>${debian_chroot:+($debian_chroot)}</code>：这是一个参数扩展。如果设置了 debian_chroot 变量，则将其值包含在提示符中，并用括号括起来。这通常用于在 chroot 环境中指示当前环境。 如果 debian_chroot未设置，则此部分不显示任何内容。<ul><li>用echo命令输出：<code>echo "${debian_chroot:+($debian_chroot)}"</code></li></ul></li></ul><p><img src="/img/202504/3.png" alt="Image 3"></p><ul><li>\u：用户的用户名（例如，"diraw"）</li><li>@：一个字面字符 "@"</li><li>\h：主机名（hostname）的第一个部分，即第一个 . 之前的字符串。例如，如果主机名是 mycomputer.example.com，则 显示 mycomputer<ul><li>在终端输出主机名：<code>hostname</code></li></ul></li></ul><p><img src="/img/202504/4.png" alt="Image 4"></p><ul><li>:：一个字面字符 ":"</li><li>\w：当前工作目录的完整路径</li><li><code>\$</code>：如果当前用户是 root 用户，则显示 #；否则，显示$</li></ul><p>我这里修改我的hostname即可</p><p>1、直接 <code>sudo hostnamectl set-hostname 新主机名</code></p><p>2、然后打开<code>/etc/hosts</code>，把第二行名称改一下</p><p><img src="/img/202504/5.png" alt="Image 5"></p><p>3、重启电脑</p><p><strong>为什么需要同时修改这两个地方？</strong></p><p>1、<code>sudo hostnamectl set-hostname 新主机名</code> →修改系统的静态主机名（存储在 <code>/etc/hostname</code>）<br>2、修改 <code>/etc/hosts</code> → 确保本地域名解析正确，避免某些程序（如sudo、ping、ssh）出现警告或错误</p><h1 id="代码学习">代码学习</h1><p>PS1 代表 "Prompt String"，是一个 Bash shell环境变量，它定义了命令提示符的格式。简单来说，PS1决定了你在终端中看到的内容，即你输入命令之前显示的字符串。</p><p>Bash 还有其他提示符变量，如 PS2（用于多行命令）、PS3（用于 select循环）和 PS4（用于调试）。</p><p>PS1 字符串中可以使用许多特殊字符（也称为转义序列），它们会被 Bash解释并替换为实际值。 一些常见的特殊字符包括：<br>- \u：用户名<br>- \h：主机名（hostname）的第一个部分<br>- \H：完整的主机名<br>- \w：当前工作目录的完整路径（~ 代表用户主目录）<br>- \W：当前工作目录的basename（最后一个目录名）<br>- <code>\$</code>：如果当前用户是 root 用户，则显示 #；否则，显示$<br>- \d：当前日期（例如，"Tue May 9"）<br>- \t：当前时间（24 小时制，HH:MM:SS）<br>- \s：shell 的名称</p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在ubuntu上面安装vscode需注意的</title>
      <link href="/2025/04/04/Linux/2/"/>
      <url>/2025/04/04/Linux/2/</url>
      
        <content type="html"><![CDATA[<h1 id="问题描述">问题描述</h1><p><strong>不要直接在ubuntu自带的应用商店上下载vscode</strong>！因为中文输入法会有问题，输入法会显示在vscode左下角，很别扭。网上有的是无法用拼音输入汉字。</p><h1 id="解决办法">解决办法</h1><p>解决办法参考<a href="https://blog.csdn.net/m0_44999129/article/details/123125650">Ubuntu20.04中VScode不能输入中文解决</a></p><p>1、去应用商店中卸载vscode</p><p>2、使用apt安装vscode</p><ul><li><code>sudo apt update</code></li><li><code>sudo apt install software-properties-common apt-transport-https wget</code></li><li>使用命令插入Microsoft GPGkey：<code>wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add -</code></li><li>启动vscode源仓库：<code>sudo add-apt-repository "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main"</code></li><li>安装vscode：<code>sudo apt install code</code></li></ul><p>wakatime：<a href="https://wakatime.com/settings/api-key" class="uri">https://wakatime.com/settings/api-key</a></p><h1 id="代码学习">代码学习</h1><p>1、<code>sudo apt install software-properties-common apt-transport-https wget</code></p><ul><li>sudo: 以超级用户权限运行命令。安装软件包通常需要超级用户权限，因为这会修改系统文件。</li><li>apt: 这是 Debian 和 Ubuntu 系统上的命令行包管理器。它用于安装、更新和删除软件包。</li><li>install: 这是 apt 命令的一个子命令，用于安装一个或多个软件包。</li><li>software-properties-common:这个软件包提供了一些用于管理软件源的工具。 它包含 add-apt-repository命令，该命令用于添加新的 APT 软件源。这对于安装来自非官方仓库的软件包非常有用。</li><li>apt-transport-https: 这个软件包允许 apt 通过 HTTPS 协议访问软件源。这对于确保软件包的安全性非常重要，因为 HTTPS 可以防止中间人攻击。</li><li>wget: 这是一个命令行下载工具，用于从 Web 服务器下载文件。在某些情况下，可能需要使用 wget 来下载软件包或配置文件。</li><li>这条命令的作用是使用 apt 包管理器安装software-properties-common、apt-transport-https 和 wget 这三个软件包。这些软件包通常用于添加和管理软件源，并通过 HTTPS 安全地下载软件包。</li></ul><p>2、<code>wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add -</code></p><ul><li>wget: 这是一个命令行下载工具，用于从 Web 服务器下载文件。</li><li>-q 或 --quiet: 静默模式。 wget 不会显示进度条或错误消息。</li><li><a href="https://packages.microsoft.com/keys/microsoft.asc" class="uri">https://packages.microsoft.com/keys/microsoft.asc</a>:这是要下载的文件的 URL。 在这个例子中，它是一个包含 Microsoft GPG 公钥的ASCII 文件。</li><li>-O-: 将下载的文件输出到标准输出 (stdout)。 -O选项用于指定输出文件名，而 - 表示标准输出。</li><li><div class="line-block">(管道): 将 wget 的标准输出连接到 sudoapt-key add - 命令的标准输入。 这意味着 wget 下载的公钥将被传递给apt-key add 命令。</div></li><li>sudo: 以超级用户权限运行命令。 添加 APT密钥通常需要超级用户权限，因为这会修改系统范围的配置。</li><li>apt-key: 这是一个用于管理 APT 密钥的工具。 APT密钥用于验证软件包的真实性。</li><li>add: 这是 apt-key 命令的一个子命令，用于添加一个新的密钥。</li><li>-: 从标准输入读取密钥。 由于 wget 的输出通过管道连接到 apt-key的输入，因此 apt-key 将从 wget 下载的公钥添加到密钥环中。</li><li>但<strong>apt-key 命令已被弃用</strong>，现在多使用 gpg 和 apt-get命令来管理 APT 密钥</li></ul><p>3、<code>sudo add-apt-repository "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main"</code></p><ul><li>sudo: 以超级用户权限运行命令。修改系统范围的软件源列表需要超级用户权限。</li><li>add-apt-repository: 这是一个用于添加新的 APT 软件源的命令。 它通常由software-properties-common 软件包提供。</li><li>"deb [arch=amd64] <a href="https://packages.microsoft.com/repos/vscode" class="uri">https://packages.microsoft.com/repos/vscode</a> stablemain": 这是一个字符串，指定要添加的软件源的详细信息。</li><li>deb: 指定这是一个 Debian 软件包的软件源。</li><li>[arch=amd64]: 指定此软件源仅适用于 amd64 架构的系统。 amd64 是 64 位x86 处理器的常用架构名称。 如果你的系统是其他架构（例如arm64），则需要修改此选项。</li><li><a href="https://packages.microsoft.com/repos/vscode" class="uri">https://packages.microsoft.com/repos/vscode</a>:这是软件源的 URL。 在这个例子中，它是 Microsoft Visual Studio Code (VSCode) 的软件源。</li><li>stable: 指定要使用的软件源的发行版。 在这个例子中，它使用 stable分支，该分支包含 VS Code 的稳定版本。</li><li>main: 指定软件源的组件。 main组件包含由软件源维护者提供的自由软件。</li><li>这条命令的作用是向你的 APT 软件源列表中添加 Microsoft VS Code的软件源，并且只适用于 amd64 架构的系统。 添加此软件源后，你可以使用 apt命令来安装和更新 VS Code。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何在ubuntu上面安装hexo</title>
      <link href="/2025/04/04/Linux/1/"/>
      <url>/2025/04/04/Linux/1/</url>
      
        <content type="html"><![CDATA[<h1 id="设备信息">设备信息</h1><p>22.04.1-Ubuntu</p><h1 id="安装步骤">安装步骤</h1><p>安装过程参考<a href="https://hexo.io/zh-cn/docs/">官方文档</a></p><p>1、安装git：<code>sudo apt-get install git-core</code></p><p>2、安装node.js（Node.js 是一个开源、跨平台的 JavaScript运行时环境）</p><p>node.js的安装过程参考<a href="https://github.com/nodesource/distributions">官方文档</a></p><ul><li>安装curl（curl是一个命令行工具，通常用于从服务器下载文件、向服务器发送数据、测试 API端点等）：<code>sudo apt-get install -y curl</code></li><li>下载node.js环境setup脚本：<code>curl -fsSL https://deb.nodesource.com/setup_23.x -o nodesource_setup.sh</code></li><li>运行setup脚本：<code>sudo -E bash nodesource_setup.sh</code></li><li>安装node.js：<code>sudo apt-get install -y nodejs</code></li><li>查看版本：<code>node -v</code></li></ul><p>3、安装hexo：<code>npm install -g hexo-cli</code></p><ul><li>如果出现如下图 EACCES 错误，查看本文下一部分内容</li></ul><p><img src="/img/202504/1.png" alt="Image 1"></p><h1 id="解决eacces报错">解决EACCES报错</h1><p>解决过程参看<a href="https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally">官方文档</a></p><p>1、在根目录下创建文件夹：<code>mkdir -p ~/.npm-global/lib</code><br>2、设置config：<code>npm config set prefix '~/.npm-global'</code><br>3、打开<code>~/.profile</code>文件，在末尾添加<code>export PATH=~/.npm-global/bin:$PATH</code><br>4、更新环境变量：<code>source ~/.profile</code></p><h1 id="代码学习">代码学习</h1><p>1、<code>curl -fsSL https://deb.nodesource.com/setup_23.x -o nodesource_setup.sh</code></p><ul><li>curl: 这是命令本身，调用 curl 工具。、</li><li>-f 或 --fail: 告诉 curl 如果 HTTP 请求失败（服务器返回 4xx 或 5xx状态码），则不输出 HTML 错误页面，而是直接退出并返回错误。这对于在脚本中使用 curl时非常有用，因为你可以根据退出代码来判断请求是否成功。</li><li>-s 或 --silent: 静默模式。 curl 不会显示进度条或错误消息。这对于在脚本中使用 curl时也很有用，因为你可能不想让输出干扰脚本的执行。</li><li>-S 或 --show-error: 与 -s 结合使用。即使在静默模式下，如果发生错误，curl 仍然会显示错误消息。这可以帮助你诊断问题。</li><li>-L 或 --location: 如果服务器返回一个重定向 (3xx 状态码)，curl会自动跟随重定向。 这对于下载重定向的文件非常有用。</li><li><a href="https://deb.nodesource.com/setup_23.x" class="uri">https://deb.nodesource.com/setup_23.x</a>:这是要下载的文件的 URL。 在这个例子中，它是一个用于设置 Node.js 23.x版本的脚本。</li><li>-o nodesource_setup.sh 或 --output nodesource_setup.sh:指定将下载的文件保存为 nodesource_setup.sh。 如果没有这个选项，curl会将文件内容输出到标准输出（通常是你的终端）。</li></ul><p>2、<code>sudo -E bash nodesource_setup.sh</code></p><ul><li>-E 默认情况下，sudo会清除大部分当前用户的环境变量，以确保以干净的环境运行命令。 -E 选项告诉sudo 保留当前用户的所有环境变量</li></ul><p>3、<code>npm install -g hexo-cli</code></p><ul><li>npm: 这是 Node Package Manager 的命令，用于管理 Node.js</li><li>-g 或 --global: 这个选项告诉 npm 将包全局安装到你的系统中。 这意味着hexo-cli 将被安装到一个全局目录，并且可以在任何地方通过命令行访问。如果没有这个选项，hexo-cli 将被安装到当前项目的 node_modules目录中，只能在当前项目中使用</li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo部署twikoo功能时MongoDB报错：tlsv1 alert internal error</title>
      <link href="/2025/01/07/Hexo/Error/2/"/>
      <url>/2025/01/07/Hexo/Error/2/</url>
      
        <content type="html"><![CDATA[<p>如下所示：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    "code": 1000,</span><br><span class="line">    "message": "80D8C13E607F0000:error:0A000438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error:ssl/record/rec_layer_s3.c:907:SSL alert number 80\n"</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>这个是使用SSL/TLS连接的时候出现了错误，之后我发现是MongoDB防火墙的问题<sub>（虽然我记得初始化的时候命明明设置了0.0.0.0/0的，但不知道为什么没设置成功）</sub></p><p><strong>解决步骤</strong>：进入MongoDB面板-左侧选择<code>Network Access</code>-点击右侧<code>ADD IP ADDRESS</code>-添加<code>0.0.0.0/0</code>即可</p><p>这是再重新访问MongoDB即恢复正常：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    "code": 100,</span><br><span class="line">    "message": "Twikoo 云函数运行正常，请参考 https://twikoo.js.org/frontend.html 完成前端的配置",</span><br><span class="line">    "version": "1.6.41"</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> twikoo </tag>
            
            <tag> MongoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于这个小站</title>
      <link href="/2025/01/05/about/"/>
      <url>/2025/01/05/about/</url>
      
        <content type="html"><![CDATA[<p>施工中……</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly魔改5：在网站底部添加建站时间</title>
      <link href="/2025/01/05/Hexo/Butterfly/Custom/5/"/>
      <url>/2025/01/05/Hexo/Butterfly/Custom/5/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>看<a href="https://butterfly.js.org/posts/4aa8abbe/?highlight=anchor#%E8%A8%AA%E5%95%8F%E4%BA%BA%E6%95%B8-busuanzi-UV-%E5%92%8C-PV">官方文档的时候</a>，明明busuanzi是有个“网站已运行时间的”，但是这里就没有。那就自己弄一个吧，这玩意儿看着感觉还是挺有成就感的。</p><h1 id="步骤">步骤</h1><p>在 <code>\themes\butterfly\layout\includes\footer.pug</code>的最后添加如下代码即可：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Add the time calculation script</span><br><span class="line">div</span><br><span class="line">span#timeDate 载入天数...</span><br><span class="line">span#times 载入时分秒...</span><br><span class="line">script.</span><br><span class="line">    var now = new Date(); </span><br><span class="line">    function createtime() { </span><br><span class="line">    var grt = new Date("1/2/2025 21:36"); // 在此处修改你的建站时间</span><br><span class="line">    now.setTime(now.getTime() + 250); </span><br><span class="line">    days = (now - grt) / 1000 / 60 / 60 / 24; </span><br><span class="line">    dnum = Math.floor(days); </span><br><span class="line">    hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); </span><br><span class="line">    hnum = Math.floor(hours); </span><br><span class="line">    if (String(hnum).length == 1) { hnum = "0" + hnum; } </span><br><span class="line">    minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); </span><br><span class="line">    mnum = Math.floor(minutes); </span><br><span class="line">    if (String(mnum).length == 1) { mnum = "0" + mnum; } </span><br><span class="line">    seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); </span><br><span class="line">    snum = Math.round(seconds); </span><br><span class="line">    if (String(snum).length == 1) { snum = "0" + snum; } </span><br><span class="line">    document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天 "; </span><br><span class="line">    document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; </span><br><span class="line">    } </span><br><span class="line">    setInterval(createtime, 250);</span><br></pre></td></tr></table></figure><p>不想要显示“秒”的话：<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">div</span><br><span class="line">  span#timeDate 载入天数...</span><br><span class="line">  span#times 载入时分...</span><br><span class="line">  script.</span><br><span class="line">    var now = new Date(); </span><br><span class="line">    function createtime() { </span><br><span class="line">      var grt = new Date("1/2/2025 21:36"); // 在此处修改你的建站时间</span><br><span class="line">      now.setTime(now.getTime() + 250); </span><br><span class="line">      days = (now - grt) / 1000 / 60 / 60 / 24; </span><br><span class="line">      dnum = Math.floor(days); </span><br><span class="line">      hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); </span><br><span class="line">      hnum = Math.floor(hours); </span><br><span class="line">      if (String(hnum).length == 1) { hnum = "0" + hnum; } </span><br><span class="line">      minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum); </span><br><span class="line">      mnum = Math.floor(minutes); </span><br><span class="line">      if (String(mnum).length == 1) { mnum = "0" + mnum; } </span><br><span class="line">      document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天 "; </span><br><span class="line">      document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分"; </span><br><span class="line">    } </span><br><span class="line">    setInterval(createtime, 250);</span><br></pre></td></tr></table></figure></p><p>只想显示“天”的话：<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">div</span><br><span class="line">  span#timeDate 载入天数...</span><br><span class="line">  script.</span><br><span class="line">    var now = new Date(); </span><br><span class="line">    function createtime() { </span><br><span class="line">      var grt = new Date("1/2/2025 21:36"); // 在此处修改你的建站时间</span><br><span class="line">      now.setTime(now.getTime() + 250); </span><br><span class="line">      days = (now - grt) / 1000 / 60 / 60 / 24; </span><br><span class="line">      dnum = Math.floor(days); </span><br><span class="line">      document.getElementById("timeDate").innerHTML = "本网站已运行 " + dnum + " 天"; </span><br><span class="line">    } </span><br><span class="line">    setInterval(createtime, 250);</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly魔改准备工作：文件管理魔改代码</title>
      <link href="/2025/01/04/Hexo/Butterfly/Custom/0/"/>
      <url>/2025/01/04/Hexo/Butterfly/Custom/0/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>对于一些全局的改变，我们可以用文件来管理更方便。</p><h1 id="步骤">步骤</h1><ol type="1"><li>在 <code>\themes\butterfly\source\css</code> 目录下添加<code>custom.css</code> 文件</li><li>在 <code>\themes\butterfly\source\js</code> 目录下添加<code>custom.js</code> 文件</li><li>在内层 <code>_config.yml</code> 文件中搜索 <code>inject</code>或者直接在外层 <code>_config.butterfly.yml</code>文件中添加如下代码即可：</li></ol><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before '&lt;/head&gt;' tag) and the bottom (before '&lt;/body&gt;' tag)</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel="stylesheet"</span> <span class="string">href="/css/custom.css"&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src="/js/custom.js"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>之后，对于一些全局的修改都可以在 <code>custom.css</code> 和<code>custom.js</code> 中编辑，这样管理和更新的时候方便些。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly魔改4：自动检测深色/浅色模式</title>
      <link href="/2025/01/04/Hexo/Butterfly/Custom/4/"/>
      <url>/2025/01/04/Hexo/Butterfly/Custom/4/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>添加功能：根据系统的深色/浅色模式，自动切换网站的深色/浅色模式。</p><h1 id="方法1">方法1</h1><p>在 <code>\themes\butterfly\layout\includes\head.pug</code>的最后添加如下代码：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">script.</span><br><span class="line">  function updateTheme() {</span><br><span class="line">    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;</span><br><span class="line">    document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // 初始设置</span><br><span class="line">  updateTheme();</span><br><span class="line"></span><br><span class="line">  // 监听系统主题变化</span><br><span class="line">  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme);</span><br></pre></td></tr></table></figure><h1 id="方法2推荐">方法2（推荐）</h1><p>先跟着<a href="https://diraw.top/2025/01/04/Hexo/Butterfly/Custom/0/">Butterfly魔改准备工作：文件管理魔改代码</a>完成准备。</p><p>在 <code>custom.js</code> 最后（最外层）直接添加如下代码即可，也就是<code>.pug</code> 文件去掉最前面的 <code>script.</code> 即可：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateTheme</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> isDarkMode = <span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">'(prefers-color-scheme: dark)'</span>).<span class="property">matches</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">setAttribute</span>(<span class="string">'data-theme'</span>, isDarkMode ? <span class="string">'dark'</span> : <span class="string">'light'</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始设置</span></span><br><span class="line"><span class="title function_">updateTheme</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听系统主题变化</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">'(prefers-color-scheme: dark)'</span>).<span class="title function_">addEventListener</span>(<span class="string">'change'</span>, updateTheme);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly魔改3：修改副标题字体大小</title>
      <link href="/2025/01/03/Hexo/Butterfly/Custom/3/"/>
      <url>/2025/01/03/Hexo/Butterfly/Custom/3/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>众所周知，Butterfly在可以在 <code>_config.yml</code> 中用<code>font</code> 配置全局的字体和代码大小，如下图所示：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Global font settings</span></span><br><span class="line"><span class="comment"># Don't modify the following settings unless you know how they work</span></span><br><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="attr">global_font_size:</span> <span class="string">16px</span></span><br><span class="line">  <span class="attr">code_font_size:</span> <span class="string">16px</span></span><br><span class="line">  <span class="attr">font_family:</span></span><br><span class="line">  <span class="attr">code_font_family:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Font settings for the site title and site subtitle</span></span><br><span class="line"><span class="attr">blog_title_font:</span></span><br><span class="line">  <span class="attr">font_link:</span></span><br><span class="line">  <span class="attr">font_family:</span></span><br></pre></td></tr></table></figure><p>但是一些更精细的调整就没有了。就比如我把全局大小设置成16px之后，我感觉我首页的副标题的中文字体有点大了，我想改小一点。</p><h1 id="步骤">步骤</h1><p>在 <code>\themes\butterfly\layout\includes\header\index.pug</code>中搜索 <code>site-subtitle</code> 可以找到：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#site-subtitle</span><br><span class="line">    span#subtitle</span><br></pre></td></tr></table></figure><p>添加 <code>(style="font-size: 22px;")</code> 即可，如下图所示：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#site-subtitle(style="font-size: 22px;")</span><br><span class="line">    span#subtitle</span><br></pre></td></tr></table></figure><p>改之前：<br><img src="/img/202501/6.png" alt="Image 6"></p><p>改之后：<br><img src="/img/202501/7.png" alt="Image 7"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly魔改2：页面渐变切换</title>
      <link href="/2025/01/03/Hexo/Butterfly/Custom/2/"/>
      <url>/2025/01/03/Hexo/Butterfly/Custom/2/</url>
      
        <content type="html"><![CDATA[<h1 id="准备工作">准备工作</h1><p>这边使用Pjax来实现页面的动画。Butterfly内置了Pjax插件，直接在<code>/themes/butterfly/_config.yml</code> 中搜索Pjax，然后把<code>enable</code> 选项改成 <code>true</code>，如下所示：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://github.com/MoOx/pjax</span></span><br><span class="line"><span class="attr">pjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Exclude the specified pages from pjax, such as '/music/'</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="comment"># - /xxxxxx/</span></span><br></pre></td></tr></table></figure><h1 id="步骤">步骤</h1><p>首先，在 <code>/themes/butterfly/source/css</code> 下创建<code>custom.css</code> 写入如下代码：</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 默认（白天模式） */</span></span><br><span class="line"><span class="selector-tag">body</span> {</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">body</span> {</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#121212</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pjax-leave-active</span> {</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: inherit;</span><br><span class="line">  <span class="comment">/* 使用继承的背景色 */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pjax-enter-active</span> {</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">1s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.22</span>, <span class="number">0.61</span>, <span class="number">0.36</span>, <span class="number">1</span>), background-color <span class="number">1s</span> ease-in-out, transform <span class="number">1s</span> ease-in-out;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: inherit;</span><br><span class="line">  <span class="comment">/* 使用继承的背景色 */</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>然后，在 <code>/themes/butterfly/source/js</code> 下创建<code>custom.js</code> 写入如下代码：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'DOMContentLoaded'</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">Pjax</span>) {</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Pjax</span>({</span><br><span class="line">      <span class="attr">elements</span>: <span class="string">'a'</span>,</span><br><span class="line">      <span class="attr">selectors</span>: [<span class="string">'title'</span>, <span class="string">'.content'</span>],</span><br><span class="line">      <span class="attr">cacheBust</span>: <span class="literal">false</span></span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'pjax:send'</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'pjax-leave-active'</span>);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'pjax:complete'</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'pjax-leave-active'</span>);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'pjax-enter-active'</span>);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'pjax-enter-active'</span>);</span><br><span class="line">      }, <span class="number">500</span>);</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 切换主题的示例代码</span></span><br><span class="line">  <span class="keyword">const</span> toggleThemeButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'toggle-theme'</span>);</span><br><span class="line">  toggleThemeButton.<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">const</span> htmlElement = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">    <span class="keyword">const</span> currentTheme = htmlElement.<span class="title function_">getAttribute</span>(<span class="string">'data-theme'</span>);</span><br><span class="line">    <span class="keyword">const</span> newTheme = currentTheme === <span class="string">'dark'</span> ? <span class="string">'light'</span> : <span class="string">'dark'</span>;</span><br><span class="line">    htmlElement.<span class="title function_">setAttribute</span>(<span class="string">'data-theme'</span>, newTheme);</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></table></figure><p>最后，在 <code>/themes/butterfly/_config.yml</code> 中搜索<code>inject</code>，或者直接在外部的 <code>_config.butterfly.yml</code>里面添加如下代码：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel="stylesheet"</span> <span class="string">href="/css/custom.css"&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src="/js/custom.js"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h1 id="调试动画">调试动画</h1><p>调试的时候，可以直接在浏览器的 <code>F12</code>下修改动画效果，也就是 <code>cubic-bezier(0.22, 0.61, 0.36, 1)</code>贝塞尔曲线，可以直接看见图片：</p><p><img src="/img/202501/5.png" alt="Image 5"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly魔改1：首页大图预加载</title>
      <link href="/2025/01/03/Hexo/Butterfly/Custom/1/"/>
      <url>/2025/01/03/Hexo/Butterfly/Custom/1/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>众所周知，Butterfly的首页大图可以通过在 <code>_config.yml</code>文件中中配置 <code>index_img</code> 选项来实现。</p><p>但是如果你用的是GitHubPages来部署的，而你配置的首页大图的大小又有好几M，不算太小的话，有时候访问网站就会出现——<strong>先加载Butterfly框架出来，此时首页大图是蓝色的默认背景，然后才逐渐把你配置的大图加载出来</strong>——的这种情况。</p><p>我不喜欢这种情况，因为我希望别人一进网站就<strong>被我的首页大图震撼</strong>(bushi)，如果图片是慢慢加载出来的话就没有那种震撼感了，甚至说体验感比较一般。所以我准备对Butterfly的源码魔改一波。</p><p>以下是Butterfly官方网站的加载情况，可以看到这个图片逐渐加载的现象：</p><p><img src="/img/202501/1.png" alt="Image 1"></p><p><img src="/img/202501/2.png" alt="Image 2"></p><p><img src="/img/202501/3.png" alt="Image 3"></p><h1 id="方法1">方法1</h1><p>现在我们来魔改一下源代码，以实现图片预加载的功能。</p><p>打开 <code>themes/butterfly/layout/includes/layout.pug</code>这个文件，在 <code>body</code> 的最前面添加如下代码：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">body(style="visibility: hidden; overflow: hidden;")</span><br><span class="line"></span><br><span class="line">    !=partial('includes/loading/index', {}, {cache: true})</span><br></pre></td></tr></table></figure><p>然后还是这个文件，拉到文件最后，会看到如下两行：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">include ./rightside.pug</span><br><span class="line">include ./additional-js.pug</span><br></pre></td></tr></table></figure><p>在 <code>include ./additional-js.pug</code> 之前添加如下代码：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">script.</span><br><span class="line">    window.onload = function() {</span><br><span class="line">    document.body.style.visibility = 'hidden';</span><br><span class="line">    document.body.style.overflow = 'hidden';</span><br><span class="line">    var fullPageElement = document.querySelector('.full_page, .post-bg');</span><br><span class="line"></span><br><span class="line">    if (fullPageElement) {</span><br><span class="line">        //- console.log('Full-page element detected.');</span><br><span class="line"></span><br><span class="line">        var style = window.getComputedStyle(fullPageElement);</span><br><span class="line">        var backgroundImage = style.backgroundImage;</span><br><span class="line">        //- console.log('Background image:', backgroundImage);</span><br><span class="line"></span><br><span class="line">        // 提取 URL，去除前5个字符和后2个字符</span><br><span class="line">        var imageUrl = backgroundImage.slice(5, -2);</span><br><span class="line">        //- console.log('Background image URL:', imageUrl);</span><br><span class="line"></span><br><span class="line">        if (imageUrl &amp;&amp; imageUrl !== 'none') {</span><br><span class="line">        var img = new Image();</span><br><span class="line">        img.crossOrigin = "anonymous"; // 如果有跨域问题，尝试添加这行</span><br><span class="line"></span><br><span class="line">        img.onload = function() {</span><br><span class="line">            //- console.log('Background image loaded.');</span><br><span class="line">            document.body.style.visibility = 'visible';</span><br><span class="line">            document.body.style.overflow = 'auto';</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        img.onerror = function() {</span><br><span class="line">            //- console.error('Failed to load background image.');</span><br><span class="line">            document.body.style.visibility = 'visible';</span><br><span class="line">            document.body.style.overflow = 'auto';</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        // 确保图片路径是正确的</span><br><span class="line">        img.src = imageUrl;</span><br><span class="line">        } else {</span><br><span class="line">        //- console.log('No background image found.');</span><br><span class="line">        document.body.style.visibility = 'visible';</span><br><span class="line">        document.body.style.overflow = 'auto';</span><br><span class="line">        }</span><br><span class="line">    } else {</span><br><span class="line">        //- console.log('No full-page element detected.');</span><br><span class="line">        document.body.style.visibility = 'visible';</span><br><span class="line">        document.body.style.overflow = 'auto';</span><br><span class="line">    }</span><br><span class="line">    };</span><br></pre></td></tr></table></figure><p>代码中有 <code>console.log</code>用来调试，取消注释后编译本地浏览打开首页，按F12进到终端，如果看到如下调试信息，则说明功能添加成功：</p><p><img src="/img/202501/4.png" alt="Image 4"></p><p>其中，<code>.full_page</code> 是首页的检测元素, <code>.post-bg</code>是文章页面的检测元素，如下图所示：</p><p><img src="/img/202501/7.png" alt="Image 7"></p><p><img src="/img/202501/8.png" alt="Image 8"></p><h1 id="方法2推荐">方法2（推荐）</h1><p>打开 <code>themes/butterfly/layout/includes/layout.pug</code>这个文件，在 <code>body</code>的最前面添加如下代码（这个和方法1是一样的）：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">body(style="visibility: hidden; overflow: hidden;")</span><br><span class="line"></span><br><span class="line">    !=partial('includes/loading/index', {}, {cache: true})</span><br></pre></td></tr></table></figure><p>然后跟着<a href="https://diraw.top/2025/01/04/Hexo/Butterfly/Custom/0/">Butterfly魔改准备工作：文件管理魔改代码</a>完成准备。</p><p>最后把之前的代码写成一个函数如下所示，把以下代码添加在<code>custom.js</code> 最后（最外层）：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkBackgroundImage</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">'hidden'</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">'hidden'</span>;</span><br><span class="line">  <span class="keyword">var</span> fullPageElement = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">'.full_page, .post-bg'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fullPageElement) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Full-page element detected.'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> style = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(fullPageElement);</span><br><span class="line">    <span class="keyword">var</span> backgroundImage = style.<span class="property">backgroundImage</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Background image:'</span>, backgroundImage);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提取 URL，去除前5个字符和后2个字符</span></span><br><span class="line">    <span class="keyword">var</span> imageUrl = backgroundImage.<span class="title function_">slice</span>(<span class="number">5</span>, -<span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Background image URL:'</span>, imageUrl);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imageUrl &amp;&amp; imageUrl !== <span class="string">'none'</span>) {</span><br><span class="line">      <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">      img.<span class="property">crossOrigin</span> = <span class="string">"anonymous"</span>; <span class="comment">// 如果有跨域问题，尝试添加这行</span></span><br><span class="line"></span><br><span class="line">      img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Background image loaded.'</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">'visible'</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">'auto'</span>;</span><br><span class="line">      };</span><br><span class="line"></span><br><span class="line">      img.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'Failed to load background image.'</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">'visible'</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">'auto'</span>;</span><br><span class="line">      };</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 确保图片路径是正确的</span></span><br><span class="line">      img.<span class="property">src</span> = imageUrl;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'No background image found.'</span>);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">'visible'</span>;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">'auto'</span>;</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'No full-page element detected.'</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">'visible'</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">'auto'</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>最后在<code>document.addEventListener('DOMContentLoaded', function () { })</code>里面（如果没有就创建一个）<strong>最前面</strong>添加<code>checkBackgroundImage();</code> 即可，如下代码所示：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'DOMContentLoaded'</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// 其他代码</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始检查背景图片</span></span><br><span class="line">  <span class="title function_">checkBackgroundImage</span>();</span><br><span class="line">});</span><br></pre></td></tr></table></figure><h1 id="注意">注意</h1><p>此篇教程只能实现刷新进入网站的时候执行功能，但是在网站页面之间进行跳转的时候却不起作用。</p><p>可能是如下原因：<br>1、单页应用（SPA）架构：页面之间的跳转实际上没有触发完整的页面加载，因此window.onload 事件不会再次触发。<br>2、浏览器缓存：浏览器可能缓存了图像或页面状态，导致 onload事件在页面跳转时不被触发。<br>3、JavaScript 框架的路由：使用 JavaScript框架进行路由时，页面跳转通常不会刷新整个页面。</p><p>搞了很久还是不行，以后再来吧。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo报错ssh: connect to host github.com port 22: Connection timed out解决办法</title>
      <link href="/2025/01/03/Hexo/Error/1/"/>
      <url>/2025/01/03/Hexo/Error/1/</url>
      
        <content type="html"><![CDATA[<p><code>hexo d</code> 报错ssh: connect to host github.com port 22:Connection timed out</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh: connect to host github.com port 22: Connection timed out</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">FATAL Something<span class="string">'s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span></span><br><span class="line"><span class="string">Error: Spawn failed</span></span><br><span class="line"><span class="string">    at ChildProcess.&lt;anonymous&gt; (E:\Blog\node_modules\hexo-deployer-git\node_modules\hexo-util\lib\spawn.js:51:21)</span></span><br><span class="line"><span class="string">    at ChildProcess.emit (events.js:400:28)</span></span><br><span class="line"><span class="string">    at ChildProcess.cp.emit (E:\Blog\node_modules\cross-spawn\lib\enoent.js:34:29)</span></span><br><span class="line"><span class="string">    at Process.ChildProcess._handle.onexit (internal/child_process.js:285:12)  </span></span><br><span class="line"><span class="string">PS E:\Blog&gt; </span></span><br></pre></td></tr></table></figure><p>在命令行直接输入 <code>ssh -T git@github.com</code>连接GitHub，返回：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\craft&gt;ssh -T git@github.com</span><br><span class="line">ssh: connect to host github.com port 22: Connection timed out</span><br></pre></td></tr></table></figure></p><p>如果 <code>hexo d</code>以前都是好的，今天突然抽风了，那应该不是ssh密钥的问题，而是端口被防火墙禁止访问了，我们尝试修改<code>~/.ssh/config</code> 使用443端口来访问：</p><ol type="1"><li>命令行 <code>cd %USERPROFILE%\.ssh</code></li><li><code>notepad config</code> 编辑 config 文件</li><li>在 notepad 中，输入以下内容：</li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  Hostname ssh.github.com</span><br><span class="line">  Port 443</span><br></pre></td></tr></table></figure><p>然后，在命令行输入 <code>ssh -T git@github.com</code> 返回：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\craft&gt;ssh -T git@github.com</span><br><span class="line">Hi Diraw! You<span class="string">'ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure></p><p>然后再 <code>hexo d</code> 应该就没问题了。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterfly报错TypeError: coverVal.indexOf is not a function解决办法</title>
      <link href="/2025/01/02/Hexo/Butterfly/Error/1/"/>
      <url>/2025/01/02/Hexo/Butterfly/Error/1/</url>
      
        <content type="html"><![CDATA[<p>魔改了一下Butterfly的源代码之后 <code>hexo g</code>出现如下报错：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">TypeError: coverVal.indexOf is not a <span class="keyword">function</span></span><br><span class="line">    at Hexo.&lt;anonymous&gt; (E:\Blog\themes\butterfly\scripts\filters\random_cover.js:15:30)</span><br><span class="line">    at Hexo.tryCatcher (E:\Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Hexo.&lt;anonymous&gt; (E:\Blog\node_modules\bluebird\js\release\method.js:15:34)</span><br><span class="line">    at E:\Blog\node_modules\hexo\dist\extend\filter.js:58:67</span><br><span class="line">    at tryCatcher (E:\Blog\node_modules\bluebird\js\release\util.js:16:23)     </span><br><span class="line">    at Object.gotValue (E:\Blog\node_modules\bluebird\js\release\reduce.js:166:18)</span><br><span class="line">    at Object.gotAccum (E:\Blog\node_modules\bluebird\js\release\reduce.js:155:25)</span><br><span class="line">    at Object.tryCatcher (E:\Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Promise._settlePromiseFromHandler (E:\Blog\node_modules\bluebird\js\release\promise.js:547:31)</span><br><span class="line">    at Promise._settlePromise (E:\Blog\node_modules\bluebird\js\release\promise.js:604:18)</span><br><span class="line">    at Promise._settlePromise0 (E:\Blog\node_modules\bluebird\js\release\promise.js:649:10)</span><br><span class="line">    at Promise._settlePromises (E:\Blog\node_modules\bluebird\js\release\promise.js:729:18)</span><br><span class="line">    at _drainQueueStep (E:\Blog\node_modules\bluebird\js\release\async.js:93:12)</span><br><span class="line">    at _drainQueue (E:\Blog\node_modules\bluebird\js\release\async.js:86:9)    </span><br><span class="line">    at Async._drainQueues (E:\Blog\node_modules\bluebird\js\release\async.js:102:5)</span><br><span class="line">    at Immediate.Async.drainQueues [as _onImmediate] (E:\Blog\node_modules\bluebird\js\release\async.js:15:14)</span><br><span class="line">    at processImmediate (internal/timers.js:464:21)</span><br></pre></td></tr></table></figure><p>打开 <code>.\themes\butterfly\scripts\filters\random_cover.js</code>文件如下：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Butterfly</span></span><br><span class="line"><span class="comment"> * ramdom cover</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">'before_post_render'</span>, <span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">const</span> imgTestReg = <span class="regexp">/\.(png|jpe?g|gif|svg|webp)(\?.*)?$/i</span></span><br><span class="line">  <span class="keyword">let</span> { <span class="attr">cover</span>: coverVal, <span class="attr">top_img</span>: topImg } = data</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add path to top_img and cover if post_asset_folder is enabled</span></span><br><span class="line">  <span class="keyword">if</span> (hexo.<span class="property">config</span>.<span class="property">post_asset_folder</span>) {</span><br><span class="line">    <span class="keyword">if</span> (topImg &amp;&amp; topImg.<span class="title function_">indexOf</span>(<span class="string">'/'</span>) === -<span class="number">1</span> &amp;&amp; imgTestReg.<span class="title function_">test</span>(topImg)) data.<span class="property">top_img</span> = <span class="string">`<span class="subst">${data.path}</span><span class="subst">${topImg}</span>`</span></span><br><span class="line">    <span class="keyword">if</span> (coverVal &amp;&amp; coverVal.<span class="title function_">indexOf</span>(<span class="string">'/'</span>) === -<span class="number">1</span> &amp;&amp; imgTestReg.<span class="title function_">test</span>(coverVal)) data.<span class="property">cover</span> = <span class="string">`<span class="subst">${data.path}</span><span class="subst">${coverVal}</span>`</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">randomCoverFn</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">    <span class="keyword">const</span> { <span class="attr">cover</span>: { <span class="attr">default_cover</span>: defaultCover } } = hexo.<span class="property">theme</span>.<span class="property">config</span></span><br><span class="line">    <span class="keyword">if</span> (!defaultCover) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(defaultCover)) <span class="keyword">return</span> defaultCover</span><br><span class="line">    <span class="keyword">const</span> num = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * defaultCover.<span class="property">length</span>)</span><br><span class="line">    <span class="keyword">return</span> defaultCover[num]</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (coverVal === <span class="literal">false</span>) <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If cover is not set, use random cover</span></span><br><span class="line">  <span class="keyword">if</span> (!coverVal) {</span><br><span class="line">    <span class="keyword">const</span> randomCover = <span class="title function_">randomCoverFn</span>()</span><br><span class="line">    data.<span class="property">cover</span> = randomCover</span><br><span class="line">    coverVal = randomCover <span class="comment">// update coverVal</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (coverVal &amp;&amp; (coverVal.<span class="title function_">indexOf</span>(<span class="string">'//'</span>) !== -<span class="number">1</span> || imgTestReg.<span class="title function_">test</span>(coverVal))) {</span><br><span class="line">    data.<span class="property">cover_type</span> = <span class="string">'img'</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">})</span><br></pre></td></tr></table></figure><p>将文件内容修改为：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Butterfly</span></span><br><span class="line"><span class="comment"> * random cover</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">'before_post_render'</span>, <span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">  <span class="keyword">const</span> imgTestReg = <span class="regexp">/\.(png|jpe?g|gif|svg|webp)(\?.*)?$/i</span></span><br><span class="line">  <span class="keyword">let</span> { <span class="attr">cover</span>: coverVal, <span class="attr">top_img</span>: topImg } = data</span><br><span class="line">  <span class="keyword">const</span> postAssetFolder = hexo.<span class="property">config</span>.<span class="property">post_asset_folder</span></span><br><span class="line">  <span class="keyword">const</span> defaultCover = hexo.<span class="property">theme</span>.<span class="property">config</span>.<span class="property">cover</span>.<span class="property">default_cover</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cache random cover if needed</span></span><br><span class="line">  <span class="keyword">let</span> randomCover;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">randomCoverFn</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">    <span class="keyword">if</span> (!defaultCover) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(defaultCover)) <span class="keyword">return</span> defaultCover</span><br><span class="line">    <span class="keyword">if</span> (!randomCover) {</span><br><span class="line">      <span class="keyword">const</span> num = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * defaultCover.<span class="property">length</span>)</span><br><span class="line">      randomCover = defaultCover[num]</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> randomCover</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add path to top_img and cover if post_asset_folder is enabled</span></span><br><span class="line">  <span class="keyword">if</span> (postAssetFolder) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> topImg === <span class="string">'string'</span> &amp;&amp; topImg.<span class="title function_">indexOf</span>(<span class="string">'/'</span>) === -<span class="number">1</span> &amp;&amp; imgTestReg.<span class="title function_">test</span>(topImg)) {</span><br><span class="line">      data.<span class="property">top_img</span> = <span class="string">`<span class="subst">${data.path}</span><span class="subst">${topImg}</span>`</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> coverVal === <span class="string">'string'</span> &amp;&amp; coverVal.<span class="title function_">indexOf</span>(<span class="string">'/'</span>) === -<span class="number">1</span> &amp;&amp; imgTestReg.<span class="title function_">test</span>(coverVal)) {</span><br><span class="line">      data.<span class="property">cover</span> = <span class="string">`<span class="subst">${data.path}</span><span class="subst">${coverVal}</span>`</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (coverVal === <span class="literal">false</span>) <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If cover is not set, use random cover</span></span><br><span class="line">  <span class="keyword">if</span> (!coverVal) {</span><br><span class="line">    <span class="keyword">const</span> randomCover = <span class="title function_">randomCoverFn</span>()</span><br><span class="line">    data.<span class="property">cover</span> = randomCover</span><br><span class="line">    coverVal = randomCover <span class="comment">// update coverVal</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> coverVal === <span class="string">'string'</span> &amp;&amp; (coverVal.<span class="title function_">indexOf</span>(<span class="string">'//'</span>) !== -<span class="number">1</span> || imgTestReg.<span class="title function_">test</span>(coverVal))) {</span><br><span class="line">    data.<span class="property">cover_type</span> = <span class="string">'img'</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">})</span><br></pre></td></tr></table></figure><p>做的改动有：<br>1. <strong>变量声明优化</strong>：将 postAssetFolder 和 defaultCover单独提取出来，避免多次访问配置。<br>2. <strong>缓存随机封面</strong>：添加了 randomCover变量，用于缓存随机封面，避免重复计算。<br>3. <strong>类型检查</strong>：在使用 indexOf 之前，增加了对 topImg 和coverVal 的类型检查，确保它们是字符串。<br>4. <strong>逻辑优化</strong>：在 randomCoverFn 中，增加了对 randomCover的缓存检查，避免多次随机选择。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
